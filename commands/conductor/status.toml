description = "Displays the current progress of the project"
prompt = """
## 1.0 SYSTEM DIRECTIVE
You are an AI agent. Your primary function is to provide a status overview of the current tracks file. This involves reading the `conductor/tracks.md` file, parsing its content, and summarizing the progress of tasks.

**CRITICAL:** Before proceeding, you should start by checking if the project has been properly set up.
1.  **Verify Tracks File:** Check if the file `conductor/tracks.md` exists. If it does not, HALT execution and instruct the user: "The project has not been set up or conductor/tracks.md has been corrupted. Please run `/conductor:setup` to set up the plan, or restore conductor/tracks.md."
2.  **Verify Track Exists:** Check if the file `conductor/tracks.md` is not empty. If it is empty, HALT execution and instruct the user: "The project has not been set up or conductor/tracks.md has been corrupted. Please run `/conductor:setup` to set up the plan, or restore conductor/tracks.md."

CRITICAL: You must validate the success of every tool call. If any tool call fails, you MUST halt the current operation immediately, announce the failure to the user, and await further instructions.

---


## 1.1 SETUP CHECK
**PROTOCOL: Verify that the Conductor environment is properly set up.**

1.  **Check for Required Files:** You MUST verify the existence of the following files in the `conductor` directory:
    -   `conductor/tech-stack.md`
    -   `conductor/workflow.md`
    -   `conductor/product.md`

2.  **Handle Missing Files:**
    -   If ANY of these files are missing, you MUST halt the operation immediately.
    -   Announce: "Conductor is not set up. Please run `/conductor:setup` to set up the environment."
    -   Do NOT proceed to Status Overview Protocol.

---

## 2.0 STATUS OVERVIEW PROTOCOL
**PROTOCOL: Follow this sequence to provide a status overview.**

### 2.1 Read Project Plan
1.  **Locate and Read:** Read the content of the `conductor/tracks.md` file.
2.  **Locate and Read:** List the tracks using shell command `ls conductor/tracks`. For each of the tracks, read the corresponding `conductor/<track_id>/plan.md` file.

### 2.2 Parse and Summarize Plan
1.  **Parse Content:**
    -   Identify major project phases/sections (e.g., top-level markdown headings).
    -   Identify individual tasks and their current status (e.g., bullet points under headings, looking for keywords like "COMPLETED", "IN PROGRESS", "PENDING").
2.  **Generate Summary:** Create a concise summary of the project's overall progress. This should include:
    -   The total number of major phases.
    -   The total number of tasks.
    -   The number of tasks completed, in progress, and pending.
3.  **Read Priority and Dependencies:**
    -   For each track, read its `metadata.json` to get priority and depends_on
    -   Group tracks by priority level: critical, high, medium, low
    -   For tracks with depends_on, check if dependencies are complete
    -   Sort tracks within each priority by created_at (oldest first)
4.  **Identify Blocked Tracks:**
    -   A track is "blocked" if any track in its depends_on is not completed
    -   Mark blocked tracks with üîí symbol
    -   For tracks with dependencies (`depends_on` not empty), show: "‚§∑ Depends on: [list]"

### 2.3 Present Status Overview
1.  **Output Summary:** Present the generated summary to the user in a clear, readable format. The status report must include:
    -   **Current Date/Time:** The current timestamp.
    -   **Project Status:** A high-level summary of progress (e.g., "On Track", "Behind Schedule", "Blocked").
    -   **Current Phase and Task:** The specific phase and task currently marked as "IN PROGRESS".
    -   **Next Action Needed:** The next task listed as "PENDING".
    -   **Blockers:** Any items explicitly marked as blockers in the plan, plus any tracks blocked by dependencies.
    -   **Phases (total):** The total number of major phases.
    -   **Tasks (total):** The total number of tasks.
    -   **Progress:** The overall progress of the plan, presented as tasks_completed/tasks_total (percentage_completed%).

2.  **Tracks by Priority Format:** Present tracks grouped by priority level:
    ```
    ### Tracks by Priority

    **üî¥ Critical**
    - [Status] track_description (X% complete)

    **üü† High**
    - [Status] track_description (X% complete)
      - üîí Blocked by: dependency_track_id

    **üü° Medium**
    - [Status] track_description (X% complete)

    **üü¢ Low**
    - [Status] track_description (X% complete)

    ### Blockers
    - [!] "Task name" in track_id [BLOCKED: reason]
    - [!] "Task name" in track_id [BLOCKED: reason]

    (If no blockers: "No blocked tasks üéâ")

    ### Dependency Graph
    (Show if any tracks have dependencies)
    track_a ‚îÄ‚îÄdepends on‚îÄ‚îÄ‚ñ∂ track_b
    ```

### 2.4 BEADS STATUS
**PROTOCOL: Display Beads task status.**

1.  **Check Beads CLI:**
    -   Execute `which bd` to check if the Beads CLI is available
    -   If `bd` is not found, present the following prompt:
        > "‚ö†Ô∏è Beads CLI (`bd`) is not installed. Beads provides persistent task memory across sessions.
        > A) Continue without Beads status
        > B) Stop - I'll install Beads first
        >
        > Please respond with A or B."
        -   **If A:** Skip remaining Beads steps.
        -   **If B:** HALT and wait for user to install Beads.
    -   If `bd` is found, continue to gather Beads status.

2.  **Gather Beads Status:**
    -   Run `bd ready` to get tasks with no blockers (ready to work)
    -   **Error Handling:** If `bd` command fails:
        > "‚ö†Ô∏è Beads command failed: <error message>
        > A) Continue without Beads status
        > B) Retry the failed command
        > C) Stop - I'll fix the issue first"
        -   If A: Skip remaining Beads steps.
        -   If B: Retry the command.
        -   If C: HALT and wait for user.
    -   Identify the active track (marked `[~]` in tracks.md)
    -   If there's an active track, check its `metadata.json` for `beads.epic_id`
    -   If epic_id exists, run `bd show <epic_id>` to get detailed task status

3.  **Present Beads Task Status:**
    ```
    ### Beads Task Status

    **Ready to Work (no blockers):**
    - bd-a3f8.1.2 P1 "Implement auth middleware"
    - bd-a3f8.2.1 P2 "Write API tests"

    **In Progress:**
    - bd-a3f8.1.1 [active] "Setup database schema"

    **Blocked:**
    - bd-a3f8.3.1 ‚§∑ Waiting on: bd-a3f8.2.1
    ```

4.  **Show Dependency Graph (if complex dependencies exist):**
    -   Display if the epic has more than 2 phases or nested dependencies
    ```
    ### Beads Dependency Graph
    bd-a3f8 (Epic: auth_20241226)
    ‚îú‚îÄ‚îÄ bd-a3f8.1 ‚úì Phase 1
    ‚îÇ   ‚îú‚îÄ‚îÄ bd-a3f8.1.1 ‚úì
    ‚îÇ   ‚îî‚îÄ‚îÄ bd-a3f8.1.2 ~
    ‚îî‚îÄ‚îÄ bd-a3f8.2 ‚óã Phase 2 (blocked by .1)
        ‚îî‚îÄ‚îÄ bd-a3f8.2.1 ‚óã
    ```

    Legend: ‚úì = completed, ~ = in progress, ‚óã = pending, ‚äò = blocked

5.  **Integrate with Final Status:**
    -   When Beads is enabled, add to the final status output:
    ```
    ### Combined Status Summary

    **Conductor Tracks:** X tracks (Y in progress, Z completed)
    **Beads Tasks:** A tasks ready, B in progress, C blocked

    **Recommended Next Action:**
    - [From Beads] bd-a3f8.1.2 "Implement auth middleware" (P1, no blockers)
    - [From Conductor] Continue task X in track_id
    ```

"""